<lift:surround with="default" at="content">
  
  <head_merge>
    <script type="text/javascript" src="/js/jquery.simplemodal.1.4.1.min.js"></script>
    <script type="text/javascript" lift="test_cond.loggedin">
    //<![CDATA[
      $(function(){
        $('#newVersionBtn').click(function(){
          $('#newVersionModal').modal({ closeClass: 'closer' });
        });
      });
      function prependNewVersionRow(version, compatibiltiy){
        $('#versions').prepend('<tr>'+
          '<td>'+version+'</td>'+
          '<td>'+compatibiltiy+'</td>'+
        '</tr>');
        // close the modal dialog programaticlaly. 
        // this is hacky as fuck tho: would prefer a neater solution.
        $('#newVersionModal').hide();
        $('#simplemodal-overlay').hide();
      }
    //]]>
    </script>
  </head_merge>
  
  <lift:ready_or_pending>
  
  <!-- content to display if the project.isReady is false -->
  <pending>
    <div class="row project">
      <div class="span15 columns box" lift="information">
        <h2>Project: <name>Name</name></h2>
        <div class="restrict">
          <p>
            <img src="/images/loading.gif" /> 
            We're just assembling the information for this newly added project. 
            <a href="">Please try again shortly.</a></p>
        </div>
      </div>
    </div>
  </pending>
  
  <!-- content to display if the project is ready -->
  <ready>
    
    <div class="row project">
      
      <div class="alert-message block-message info" id="project-contributor" lift="is_contributor">
        <a href="#" class="close">Ã—</a>
        <p><strong>Welcome!</strong> Because you have contributed to this project you 
           can edit the description, add new versions and sync statistics with the
           repository on github.com.</p>
        <div class="alert-actions">
          <a class="btn small">Tell me more</a>
          <a class="btn small">Don't show this again</a>
        </div>
      </div>
      
      <div class="span11 columns box" lift="information">
        <h2>Project: <name>Name</name></h2>
        
        <div class="restrict description">
          <description />
        </div>

        <h2>Compatibility</h2>
        <div class="restrict">
          <div class="row">
            <p class="span7 columns">Versions of <strong><name></name></strong> are compatible with:</p>
            <div class="span2 columns" lift="is_contributor">
              <a class="btn success" id="newVersionBtn">Add version</a>
            </div>

          </div>

          <table class="zebra-striped">
            <thead>
              <th>Version</th>
              <th>Scala Version</th>
            </thead>
            <tbody id="versions" lift="versions">
              <tr>
                <td><version></version></td>
                <td><scalaversion></scalaversion></td>
              </tr>
            </tbody>
          </table>

        </div>
        
        <lift:modules>
          
          <h2>Modules</h2>
          <div class="restrict">
            <div class="row">
              <p class="span8 columns">The <name></name> project includes the following modules:</p>
            </div><!-- eo.row -->
            <table class="zebra-striped">
              <thead>
                <th>Module</th>
                <th>Description</th>
              </thead>
              <tbody id="versions">
                <tr>
                  <td><module_name></module_name></td>
                  <td><module_description></module_description></td>
                </tr>
              </tbody>
            </table>
          </div>
          
        </lift:modules>
        
        <h2>Usage</h2>
        <div class="restrict" lift="usage_examples">
          <p><strong><tool_name></tool_name></strong></p>
          <usage></usage>
        </div>

      </div>

      <div class="span5 columns box contributors" style="margin-left: 16px">
        <h2>Overview</h2>
        <div class="overview">
          <ul lift="overview">
            <li><strong>Version</strong>: <latest_version></latest_version></li>
            <li><strong>Age</strong>: <age></age></li>
            <li><strong>Contributors</strong>: <contributor_count></contributor_count></li>
          </ul>
          <div class="activity" style="clear: both" lift="information">
            <img alt="activity" src="/images/activity-moderate.png" />
            <span class="activity-text"><strong>Fair</strong></span>
          </div>
        </div>

        <h2>Contributors</h2>
        <ol>
          <li class="row buffer"></li>
          <li class="row" lift="contributors">
            <span class="avatar-frame">
              <img src="http://0.gravatar.com/avatar/63bc2441352e761a0eff115fb713a904?s=69&d=monsterid" />
              <span class="overlay"></span>
            </span>
            <h4>Timothy Perrett</h4>
            <p>127 commits</p>
          </li><!-- eo.row -->

        </ol>
      </div>

    </div>

    <lift:tail>
      <lift:test_cond.loggedin>
        <lift:version_wizard ajax="true" />
      </lift:test_cond.loggedin>
    </lift:tail>

    <script type="text/javascript" lift="tail">
    //<![CDATA[
    $(function(){
      $('ol li.row:gt(7)').hide();
      $('ol li.row:nth-child(8)').after("<li><a id='morecontributors' href='#'>Show all...</a></li>");
      $('#morecontributors').live('click', function() {
        var li = $(this).parents("li:first");
        li.parent().children().show();
        li.remove();
        return false;
      });
    });
    //]]>
    </script>
  </ready>
  
  </lift:ready_or_pending>
  
</lift:surround>